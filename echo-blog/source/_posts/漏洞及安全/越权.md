---
title: 越权的认识及防御
categories:
- 漏洞及安全
tags: 越权
date:
---

越权：
1. 垂直越权：普通用户能够访问超级管理员资源等操作；
-----解决方案：基于权限角色来做权限管理操作；

2. 水平越权：普通用户能够对同层级用户进行资源访问操作；
-----解决方案：建立用户和可操作资源之间的绑定关系，用户对资源进行任何操作，通过该绑定关系确保该资源是属于该用户所有的；

3. 上下文相关权限：？？？？？-----不是特别好理解



## 水平权限问题：
场景：用户可以通过接口参数中id+1等操作，来实现对其他用户资源的获取；
解决方案：
1. 水平权限参数不要用自增值，用id加密、随机数或GUID(global unique id:全局唯一标识)，但搜索引擎或攻击者可以同样用这个随机数和连接去进行操作；
2. web层检查发起请求的用户权限，比如从session信息中获取；
3. 数据库表增加ownerId字段，增删改查询时加上其作为where语句条件（即每一个信息增加一个发布人的字段，修改的人必须与发布的人为同一个人才可以访问）-----和承办人belong_user是一样的原理；

## 垂直权限问题
场景：Web应用没有做权限控制，或仅仅在菜单上做了权限控制，导致恶意用户只要猜到了其他页面的URL，就可以访问或控制其他角色拥有的数据或页面，达到权限提升的目的；
解决方案：
1. 对url资源进行权限校验操作；


##总结
1. 永远不要相信来自客户端（用户）的输入！------实现：后台对前端传递的参数一定要进行严格的参数校验
2. 执行关键操作前必须验证用户身份，多阶段功能的每一步都要验证用户身份。
3. 对于直接对象引用，加密资源ID，以防止攻击者对ID进行枚举。
4. 在前端实现的验证并不可靠，前端可以验证用户的输入是否合规，在服务器端验证用户权限。

