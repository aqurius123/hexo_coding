---
title: Xss & Csrf的认识及防御
categories:
- 漏洞及安全
tags: Xss/Csrf
date:
---

> 互联网时代虽不如现实战场上充斥着显眼可见的伤与血，但是每时每刻都在上演着攻与防的暗潮涌动；

## 一、Xss(Cross Site Scripting:跨站脚本攻击)：
恶意攻击者往Web页面里插入恶意Script代码，当用户浏览该页之时，嵌入其中Web里面的Script代码会被执行，从而达到恶意攻击用户的目的。**XSS攻击针对的是用户层面的攻击！**

### Xss分类：
1. 存储型
2. 放射型
3. DOM型

#### 反射型Xss攻击：
!["反射型Xss攻击流程"](C:\Users\Admin\Desktop\反射型Xss.png)

#### 存储型Xss攻击：
!["存储型Xss攻击流程"](C:\Users\Admin\Desktop\存储型Xss.png)

### 反射型Xss、存储型Xss和DOM型Xss的区别：
1. 反射型XSS：非持久化，需要欺骗用户自己去点击链接才能触发XSS代码（服务器中没有这样的页面和内容），一般容易出现在搜索页面；
2. 存储型XSS：存储型XSS，持久化，代码是存储在服务器中的，如在个人信息或发表文章等地方，插入代码，如果没有过滤或过滤不严，那么这些代码将储存到服务器中，用户访问该页面的时候触发代码执行。这种XSS比较危险，容易造成蠕虫，盗窃cookie；
3. DOM型XSS：不经过后端，DOM-XSS漏洞是基于文档对象模型(Document Objeet Model,DOM)的一种漏洞，DOM-XSS是通过url传入参数去控制触发的，其实也属于反射型XSS。 

### 对Xss的防御（**总的来说就是：严格过滤输入，转义输出**）
XSS防御的总体思路是：对用户的输入(和URL参数)进行过滤，对输出进行html编码。也就是对用户提交的所有内容进行过滤，对url中的参数进行过滤，过滤掉会导致脚本执行的相关内容；然后对动态输出到页面的内容进行html编码，使脚本无法在浏览器中执行。

> 对输入的内容进行过滤，可以分为黑名单过滤和白名单过滤。黑名单过滤虽然可以拦截大部分的XSS攻击，但是还是存在被绕过的风险。白名单过滤虽然可以基本杜绝XSS攻击，但是真实环境中一般是不能进行如此严格的白名单过滤的。

> 对输出进行html编码，就是通过函数，将用户的输入的数据进行html编码，使其不能作为脚本运行。

## 二、CSRF(Cross Site Request Forgery:跨站请求伪造)：
攻击者利用当前用户登录后的用户身份，去执行一些恶意操作，以达到自己所需的目的；

###   CSRF攻击攻击原理及过程如下：
1. 用户C打开浏览器，访问受信任网站A，输入用户名和密码请求登录网站A；
2. 在用户信息通过验证后，网站A产生Cookie信息并返回给浏览器，此时用户登录网站A成功，可以正常发送请求到网站A；
3. 用户未退出网站A之前，在同一浏览器中，打开一个TAB页访问网站B；
4. 网站B接收到用户请求后，返回一些攻击性代码，并发出一个请求要求访问第三方站点A；
5.  浏览器在接收到这些攻击性代码后，根据网站 B 的请求，在用户不知情的情况下携带 Cookie 信息，向网站 A 发出请求。网站 A 并不知道该请求其实是由 B 发起的，所以会根据用户 C 的 Cookie 信息以 C 的权限处理该请求，导致来自网站 B 的恶意代码被执行。  

###   防御CSRF攻击： 
1. 验证HTTP Referer字段
2. 在请求地址中添加token验证
3. 在HTTP头中自定义属性并验证











详情参考文档：

[Xss认识及防御](https://blog.csdn.net/qq_35393693/article/details/86597707)

[CSRF认识及防御](https://blog.csdn.net/xiaoxinshuaiga/article/details/80766369)
